# python_voice_assistant

## Зависимости

- python = "^3.10"
- vosk = "^0.3.45" - библиотека для распознования речи
- loguru = "^0.7.0" - библиотека для логирования
- silero = "^0.4.1" - библиотека для синтеза речи
- sounddevice = "^0.4.6" - библиотека для ввода голосовых команд
- numpy = "^1.24.3" - библиотека для вычисления косинусного расстояния при распозновании диктора
- pydantic = "^1.10.7" - библиотека для валидации переменных окружения
- python-dotenv = "^1.0.0" - библиотека для чтения переменных окружения

Модели для распознования можно скачать на [официальном сайте vosk](https://alphacephei.com/vosk/models) (нужна модель распознования языка и модель распознования диктора Speaker identification model)

## Переменные окружения

- SPEAKER_MODEL_PATH=models/speaker_model # Путь до скаченной ранее модели распознования диктора
- RECOGNIZING_MODEL_PATH=models/recognizing_model # Путь до скаченной ранее модели распознования языка

- LANGUAGE=ru # Язык помощника
- MODEL_ID=ru_v3 # Модель языка помощника
- SPEAKER=random # Модель голоса помощника. Варианты: aidar, baya, kseniya, xenia, random
- DEVICE_TYPE=cpu # Девайс, на котором будет рендериться голос. cpu - процессор, gpu - видеокарта

- NAME=Настя # Имя ассистента
- GENDER=1 # Пол ассистента. 1 - женский, 0 - мужской


## Описание основных методов

### Helper.command

Метод-декоратор для привязки команд голосового помощника. Пример:

```
@helper.command("Привет")
def hello(voice: dict):
    helper.speaker.say("Здравствуйте!")
```

Декоратор принимает на вход имя команды. Сама функция принимает словарь voice следующей структуры:
```
{
    'spk': ['123', '312321'] # вектор голоса
    'spk_frames': 12312 # количество фреймов в векторе голоса
    'text': Текст команды с обрезанным именем помощника и текстом самой команды
}
```


### Helper.speaker.say

Метод для воспроизведения текста в речь. Пример:
```
@helper.command("стоп")
def stop(_):
    helper.speaker.say("До свидания!")
    exit(0)
```

Метод принимает на вход текст, который нужно произнести помощнику.


### Helper.listener.add_speaker

Метод для создания диктора в базе голосового помощника. Пример:

```
@helper.command("меня зовут")
def create_speaker(voice):
    data = {"speaker": voice["text"], "spk": voice["spk"]}
    helper.listener.add_speaker(data)
    helper.speaker.say(f"Здравствуйте, {voice['text']}")
```

### Helper.listener.identify_speaker

Метод для идентификации диктора на основе голосов в базе. Пример:

```
@helper.command("как меня зовут")
def identify(voice: dict):
    name = helper.listener.identify_speaker(voice["spk"], min_propability=40)[0]
    helper.speaker.say(f"Я думаю вас зовут {name}")
```

Принимает на вход вектор голоса и минимальную вероятность, для определения диктора.

### Helper.listen

Метод, запускающий прослушивание команд в бесконецном цикле. Для общения с голосовым помощником
нужно назвать его по имени. Например: "настя привет"


Примеры создания ассистента можно посмотреть [по данной ссылке](../examples/)
